<?xml version="1.0" ?>

<project name="shows" default="converter" basedir=".">

<!--	This assumes that jwsdp is installed at /usr/local/jwsdp-1.3/ 
		Otherwise can be set with "ant -Djwsdp.home=..." -->

<property name="jwsdp.home" value="/usr/local/jwsdp-1.3" />

<path id="jaxb_classpath">
	<pathelement path="." />
	<!-- for use with bundled ant -->
	<fileset dir="${jwsdp.home}" includes="jaxb/lib/*.jar" />
	<fileset dir="${jwsdp.home}" includes="jwsdp-shared/lib/*.jar" />
	<fileset dir="${jwsdp.home}" includes="jaxp/lib/**/*.jar" />
</path>

<taskdef name="xjc" classname="com.sun.tools.xjc.XJCTask">
	<classpath refid="jaxb_classpath" />
</taskdef>

<property name="data.dir" value="../data/" />

<property name="src.dir" value="src" />
<property name="lib.dir" value="lib" />
<property name="dist.dir" value="dist" />

<property name="build.dir" value="build" />
<property name="build.classes" value="${build.dir}/classes" />
<property name="build.lib" value="${build.dir}/lib" />
<property name="build.gensrc" value="${build.dir}/gensrc" />

<property name="javac.debug" value="no" />

<target name="clean">
	<delete dir="${build.dir}" />
</target>

<target name="prepare">
	<tstamp/>
	<mkdir dir="${build.dir}" />
	<mkdir dir="${build.classes}" />
	<mkdir dir="${build.lib}" />
	<mkdir dir="${build.gensrc}" />
</target>

<target name="music_binding" depends="prepare">
	<xjc schema="xml/music.xsd" target="${build.gensrc}" package="com.bolsinga.music.data" removeOldOutput="yes">
		<depends dir="xml" includes="music.xsd" />
		<produces dir="${build.gensrc}/com/bolsinga/music/data" includes="*impl/*" />
	</xjc>
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${build.gensrc}" />
		<include name="com/bolsinga/music/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
	<copy todir="${build.classes}">
		<fileset dir="${build.gensrc}" >
			<exclude name="**/*.java" />
		</fileset>
	</copy>
</target>

<target name="diary_binding" depends="prepare">
	<xjc schema="xml/diary.xsd" target="${build.gensrc}" package="com.bolsinga.diary.data" removeOldOutput="yes">
		<depends dir="xml" includes="diary.xsd" />
		<produces dir="${build.gensrc}/com/bolsinga/diary/data" includes="*impl/*" />
	</xjc>
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${build.gensrc}" />
		<include name="com/bolsinga/diary/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
	<copy todir="${build.classes}">
		<fileset dir="${build.gensrc}" >
			<exclude name="**/*.java" />
		</fileset>
	</copy>
</target>

<path id="web_classpath">
	<path refid="jaxb_classpath" />
	<pathelement path="${lib.dir}/ecs-1.4.2.jar" />
</path>

<target name="music_utilities" depends="music_binding">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/music/util/**" />
		<classpath refid="web_classpath" />
	</javac>
</target>

<target name="converter" depends="music_utilities, diary_binding">
	<javac	destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/shows/converter/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
</target>

<target name="music_web" depends="music_utilities">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/music/web/**" />
		<classpath refid="web_classpath" />
	</javac>
	<tstamp>
		<format property="music.builddate" pattern="EEE MMM dd HH:mm:ss z yyyy" />
	</tstamp>
	<copy file="${src.dir}/properties/config.properties" tofile="${build.classes}/com/bolsinga/music/web/web.properties">
		<filterset>
			<filter token="builddate" value="${music.builddate}" />
			<filter token="program" value="MusicWeb" />
		</filterset>
	</copy>
</target>

<target name="diary_web" depends="diary_binding">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/diary/web/**" />
		<include name="com/bolsinga/diary/util/**" />
		<classpath refid="web_classpath" />
	</javac>
	<tstamp>
		<format property="diary.builddate" pattern="EEE MMM dd HH:mm:ss z yyyy" />
	</tstamp>
	<copy file="${src.dir}/properties/config.properties" tofile="${build.classes}/com/bolsinga/diary/web/web.properties">
		<filterset>
			<filter token="builddate" value="${diary.builddate}" />
			<filter token="program" value="DiaryWeb" />
		</filterset>
	</copy>
</target>

<target name="ical-gen" depends="prepare">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/ical/**" />
	</javac>
</target>

<target name="ical" depends="ical-gen, music_utilities">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/music/ical/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
</target>

<target name="music">
	<jar jarfile="${build.lib}/music.jar"
		basedir="${build.classes}" >
		<include name="com/bolsinga/**" />
	</jar>
</target>

<path id="music_classpath">
	<path refid="jaxb_classpath" />
	<pathelement path="${build.lib}/music.jar" />
</path>

<target name="generateMusicXML" depends="converter, music">
	<java classname="com.bolsinga.shows.converter.Music" fork="true">
		<arg value="${data.dir}shows.txt" />
		<arg value="${data.dir}venuemap.txt" />
		<arg value="${data.dir}bandsort.txt" />
		<arg value="${data.dir}relations.txt" />
		<arg value="${data.dir}music.xml" />
		<classpath refid="music_classpath" />
	</java>
</target>

<target name="generateDiaryXML" depends="converter, music">
	<java classname="com.bolsinga.shows.converter.Diary" fork="true">
		<arg value="${data.dir}comments.txt" />
		<arg value="${data.dir}statics.txt" />
		<arg value="${data.dir}diary.xml" />
		<classpath refid="music_classpath" />
	</java>
</target>

<path id="generate_web_classpath">
	<path refid="music_classpath" />
	<pathelement path="${lib.dir}/ecs-1.4.2.jar" />
</path>

<target name="generateMusicWeb" depends="music_web, music">
	<mkdir dir="/tmp/web/" />
	<java classname="com.bolsinga.music.web.Web" fork="true">
		<sysproperty key="ecs.properties" value="${src.dir}/properties/web.ecs.properties" />
		<sysproperty key="music.contact" value="bolsinga@hotmail.com" />
		<sysproperty key="music.root" value="../index.html" />
		<arg value="${data.dir}music.xml" />
		<arg value="/tmp/web/" />
		<classpath refid="generate_web_classpath" />
	</java>
</target>

<target name="generateDiaryWeb" depends="music_web, diary_web, music">
	<mkdir dir="/tmp/web/" />
	<java classname="com.bolsinga.diary.web.Web" fork="true">
		<sysproperty key="ecs.properties" value="${src.dir}/properties/web.ecs.properties" />
		<sysproperty key="diary.title" value="En Vogue Webmaster" />
		<sysproperty key="diary.contact" value="bolsinga@hotmail.com" />
		<sysproperty key="diary.root" value="../index.html" />
		<arg value="3" />
		<arg value="${data.dir}diary.xml" />
		<arg value="${data.dir}music.xml" />
		<arg value="/tmp/web/" />
		<classpath refid="generate_web_classpath" />
	</java>
</target>

<target name="generateICal" depends="ical, music">
	<mkdir dir="/tmp/ical/" />
	<java classname="com.bolsinga.music.ical.ICal" fork="true">
		<arg value="${data.dir}music.xml" />
		<arg value="/tmp/ical/" />
		<classpath refid="music_classpath" />
	</java>
</target>

<target name="generateAll" depends="converter, music_web, diary_web, ical, music, generateMusicXML, generateDiaryXML, generateMusicWeb, generateDiaryWeb, generateICal">
</target>

</project>
