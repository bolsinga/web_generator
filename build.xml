<?xml version="1.0" ?>

<project name="shows" default="converter" basedir=".">

<!--	This assumes that jwsdp is installed at /usr/local/jwsdp-1.3/ 
		Otherwise can be set with "ant -Djwsdp.home=..." -->

<property name="jwsdp.home" value="/usr/local/jwsdp-1.3" />

<path id="jaxb_classpath">
	<pathelement path="." />
	<!-- for use with bundled ant -->
	<fileset dir="${jwsdp.home}" includes="jaxb/lib/*.jar" />
	<fileset dir="${jwsdp.home}" includes="jwsdp-shared/lib/*.jar" />
	<fileset dir="${jwsdp.home}" includes="jaxp/lib/**/*.jar" />
</path>

<taskdef name="xjc" classname="com.sun.tools.xjc.XJCTask">
	<classpath refid="jaxb_classpath" />
</taskdef>

<property name="data.dir" value="../data/" />

<property name="src.dir" value="src" />
<property name="lib.dir" value="lib" />
<property name="dist.dir" value="dist" />

<property name="build.dir" value="build" />
<property name="build.classes" value="${build.dir}/classes" />
<property name="build.lib" value="${build.dir}/lib" />
<property name="build.gensrc" value="${build.dir}/gensrc" />

<property name="javac.debug" value="no" />

<target name="clean">
	<delete dir="${build.dir}" />
</target>

<target name="prepare">
	<tstamp/>
	<mkdir dir="${build.dir}" />
	<mkdir dir="${build.classes}" />
	<mkdir dir="${build.lib}" />
	<mkdir dir="${build.gensrc}" />
</target>

<target name="jaxb" depends="prepare">
	<xjc schema="xml/music.xsd" target="${build.gensrc}" package="com.bolsinga.music.data"/>
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${build.gensrc}" />
		<include name="com/bolsinga/music/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
	<copy todir="${build.classes}">
		<fileset dir="${build.gensrc}" >
			<exclude name="**/*.java" />
		</fileset>
	</copy>
</target>

<target name="converter" depends="jaxb">
	<javac	destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/shows/converter/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
</target>

<target name="utilities" depends="converter">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/music/util/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
</target>

<path id="web_classpath">
	<path refid="jaxb_classpath" />
	<pathelement path="${lib.dir}/ecs-1.4.2.jar" />
</path>

<target name="web" depends="utilities">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/music/web/**" />
		<classpath refid="web_classpath" />
	</javac>
</target>

<target name="music" depends="web">
	<jar jarfile="${build.lib}/music.jar"
		basedir="${build.classes}" >
		<include name="com/bolsinga/**" />
	</jar>
</target>

<path id="music_classpath">
	<path refid="jaxb_classpath" />
	<pathelement path="${build.lib}/music.jar" />
</path>

<target name="generateXML" depends="music">
	<java classname="com.bolsinga.shows.converter.Music" fork="true">
		<arg value="${data.dir}shows.txt" />
		<arg value="${data.dir}venuemap.txt" />
		<arg value="${data.dir}bandsort.txt" />
		<arg value="${data.dir}relations.txt" />
		<arg value="${data.dir}music.xml" />
		<classpath refid="music_classpath" />
	</java>
</target>

<target name="generateWeb" depends="music">
	<mkdir dir="/tmp/web/" />
	<java classname="com.bolsinga.music.web.Web" fork="true">
		<arg value="${data.dir}music.xml" />
		<arg value="/tmp/web/" />
		<classpath refid="music_classpath" />
	</java>
</target>

</project>
