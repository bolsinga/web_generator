<?xml version="1.0" ?>

<project name="shows" default="Site" basedir=".">

<!--    This assumes that jwsdp is installed at ${lib.dir}/jwsdp-1_3/ 
                Otherwise can be set with "ant -Djwsdp.home=..." -->

<property name="legacy_data.dir" value="../data/" />
<property name="itunes.dir" value="../data/" />
<property name="data.dir" value="../data/" />
<property name="output.dir" value="/tmp/web" />

<property name="src.dir" value="src" />
<property name="lib.dir" value="lib" />
<property name="dst.dir" value="dst" />

<property name="build.dir" value="output" />
<property name="build.classes" value="${build.dir}/classes" />
<property name="build.lib" value="${build.dir}/lib" />
<property name="build.gensrc" value="${build.dir}/gensrc" />

<property name="dst.lib" value="${dst.dir}/lib" />

<property name="jwsdp.home" value="${lib.dir}/jwsdp-1_3" />

<path id="jaxb_xjc_classpath">
        <pathelement path="." />
        <pathelement path="${jwsdp.home}/jaxb/lib/jaxb-xjc.jar" />
</path>

<path id="jaxb_binder_classpath">
        <pathelement path="." />
        <pathelement path="${jwsdp.home}/jaxb/lib/jaxb-api.jar" />
        <pathelement path="${jwsdp.home}/jaxb/lib/jaxb-impl.jar" />
        <pathelement path="${jwsdp.home}/jaxb/lib/jaxb-libs.jar" />
        <pathelement path="${jwsdp.home}/jwsdp-shared/lib/jax-qname.jar" />
        <pathelement path="${jwsdp.home}/jwsdp-shared/lib/namespace.jar" />
        <pathelement path="${jwsdp.home}/jwsdp-shared/lib/relaxngDatatype.jar" />
        <pathelement path="${jwsdp.home}/jwsdp-shared/lib/xsdlib.jar" />
</path>

<taskdef name="xjc" classname="com.sun.tools.xjc.XJCTask">
        <classpath refid="jaxb_xjc_classpath" />
</taskdef>

<property name="javac.debug" value="no" />

<target name="clean">
        <delete dir="${build.dir}" />
</target>

<target name="prepare">
        <tstamp/>
        <mkdir dir="${build.dir}" />
        <mkdir dir="${build.classes}" />
        <mkdir dir="${build.lib}" />
        <mkdir dir="${build.gensrc}" />
</target>

<target name="music_binding" depends="prepare">
        <xjc schema="xml/music.xsd" target="${build.gensrc}" package="com.bolsinga.music.data" removeOldOutput="yes">
                <depends dir="xml" includes="music.xsd" />
                <produces dir="${build.gensrc}/com/bolsinga/music/data" includes="*impl/*" />
        </xjc>
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${build.gensrc}" />
                <include name="com/bolsinga/music/data/**" />
                <classpath refid="jaxb_binder_classpath" />
        </javac>
        <copy todir="${build.classes}">
                <fileset dir="${build.gensrc}" >
                        <exclude name="**/*.java" />
                </fileset>
        </copy>
</target>

<target name="diary_binding" depends="prepare">
        <xjc schema="xml/diary.xsd" target="${build.gensrc}" package="com.bolsinga.diary.data" removeOldOutput="yes">
                <depends dir="xml" includes="diary.xsd" />
                <produces dir="${build.gensrc}/com/bolsinga/diary/data" includes="*impl/*" />
        </xjc>
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${build.gensrc}" />
                <include name="com/bolsinga/diary/data/**" />
                <classpath refid="jaxb_binder_classpath" />
        </javac>
        <copy todir="${build.classes}">
                <fileset dir="${build.gensrc}" >
                        <exclude name="**/*.java" />
                </fileset>
        </copy>
</target>

<target name="rss_binding" depends="prepare">
        <xjc schema="xml/rss-2_0.xsd" target="${build.gensrc}" package="com.bolsinga.rss.data" removeOldOutput="yes" extension="true">
                <depends dir="xml" includes="rss-2_0.xsd" />
                <produces dir="${build.gensrc}/com/bolsinga/rss/data" includes="*impl/*" />
        </xjc>
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${build.gensrc}" />
                <include name="com/bolsinga/rss/data/**" />
                <classpath refid="jaxb_binder_classpath" />
        </javac>
        <copy todir="${build.classes}">
                <fileset dir="${build.gensrc}" >
                        <exclude name="**/*.java" />
                </fileset>
        </copy>
</target>

<target name="plist_binding" depends="prepare">
        <xjc schema="xml/PropertyList-1.0.xsd" target="${build.gensrc}" package="com.bolsinga.plist.data" removeOldOutput="yes" extension="true">
                <depends dir="xml" includes="PropertyList-1.0.xsd" />
                <produces dir="${build.gensrc}/com/bolsinga/plist/data" includes="*impl/*" />
        </xjc>
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${build.gensrc}" />
                <include name="com/bolsinga/plist/data/**" />
                <classpath refid="jaxb_binder_classpath" />
        </javac>
        <copy todir="${build.classes}">
                <fileset dir="${build.gensrc}" >
                        <exclude name="**/*.java" />
                </fileset>
        </copy>
</target>

<target name="settings_binding" depends="prepare">
        <xjc schema="xml/settings.xsd" target="${build.gensrc}" package="com.bolsinga.settings.data" removeOldOutput="yes" extension="true">
                <depends dir="xml" includes="settings.xsd" />
                <produces dir="${build.gensrc}/com/bolsinga/settings/data" includes="*impl/*" />
        </xjc>
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${build.gensrc}" />
                <include name="com/bolsinga/settings/data/**" />
                <classpath refid="jaxb_binder_classpath" />
        </javac>
        <copy todir="${build.classes}">
                <fileset dir="${build.gensrc}" >
                        <exclude name="**/*.java" />
               </fileset>
        </copy>
</target>

<path id="web_classpath">
        <path refid="jaxb_binder_classpath" />
        <pathelement path="${lib.dir}/ecs-1.4.2.jar" />
</path>

<target name="plist_utilities" depends="plist_binding">
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${src.dir}" />
                <include name="com/bolsinga/plist/*.java" />
                <classpath refid="jaxb_binder_classpath" />
        </javac>
</target>

<target name="web" depends="settings_binding, music_binding, diary_binding">
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${src.dir}" />
                <include name="com/bolsinga/web/*.java" />
                <classpath refid="web_classpath" />
        </javac>
        <tstamp>
                <format property="web.builddate" pattern="EEE MMM dd HH:mm:ss z yyyy" />
                <format property="web.buildyear" pattern="yyyy" />
        </tstamp>
        <copy file="${src.dir}/properties/config.properties" tofile="${build.classes}/com/bolsinga/web/web.properties">
                <filterset>
                        <filter token="builddate" value="${web.builddate}" />
                        <filter token="program" value="com.bolsinga.site" />
                        <filter token="copyright" value="Program Copyright (c) 2004-${web.buildyear} Greg Bolsinga" />
                </filterset>
        </copy>
</target>

<target name="music_converter" depends="music, itunes_converter, diary_binding">
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${src.dir}" />
                <include name="com/bolsinga/shows/converter/*.java" />
                <classpath refid="jaxb_binder_classpath" />
        </javac>
</target>

<target name="itunes_converter" depends="plist_utilities, music">
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${src.dir}" />
                <include name="com/bolsinga/itunes/converter/*.java" />
                <classpath refid="jaxb_binder_classpath" />
        </javac>
</target>

<target name="music" depends="ical_gen, web">
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${src.dir}" />
                <include name="com/bolsinga/music/*.java" />
                <classpath refid="web_classpath" />
        </javac>
</target>

<target name="diary" depends="music, web, diary_binding">
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${src.dir}" />
                <include name="com/bolsinga/diary/*.java" />
                <classpath refid="web_classpath" />
        </javac>
</target>

<target name="rss" depends="music, diary, rss_binding">
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${src.dir}" />
                <include name="com/bolsinga/rss/*.java" />
                <classpath refid="jaxb_binder_classpath" />
        </javac>
</target>

<target name="ical_gen" depends="prepare">
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${src.dir}" />
                <include name="com/bolsinga/ical/*.java" />
        </javac>
</target>

<target name="site" depends="music, diary, rss">
        <javac  destdir="${build.classes}"
                        debug="${javac.debug}"
                        deprecation="on">
                <src path="${src.dir}" />
                <include name="com/bolsinga/site/*.java" />
                <classpath refid="web_classpath" />
        </javac>
</target>

<target name="jar">
        <jar jarfile="${build.lib}/music.jar"
                basedir="${build.classes}" >
                <include name="com/bolsinga/**" />
        </jar>
</target>

<path id="music_classpath">
        <path refid="jaxb_binder_classpath" />
        <pathelement path="${build.lib}/music.jar" />
</path>

<target name="generateMusicXML" depends="music_converter, jar">
        <java classname="com.bolsinga.shows.converter.Music" fork="true">
                <arg value="${legacy_data.dir}shows.txt" />
                <arg value="${legacy_data.dir}venuemap.txt" />
                <arg value="${legacy_data.dir}bandsort.txt" />
                <arg value="${legacy_data.dir}relations.txt" />
                <arg value="${itunes.dir}iTunes Music Library.xml" />
                <arg value="${data.dir}music.xml" />
                <classpath refid="music_classpath" />
        </java>
</target>

<target name="generateDiaryXML" depends="music_converter, jar">
        <java classname="com.bolsinga.shows.converter.Diary" fork="true">
                <sysproperty key="diary.title" value="En Vogue Webmaster" />
                <arg value="${legacy_data.dir}comments.txt" />
                <arg value="${legacy_data.dir}statics.txt" />
                <arg value="${data.dir}diary.xml" />
                <classpath refid="music_classpath" />
        </java>
</target>

<path id="generate_web_classpath">
        <path refid="music_classpath" />
        <pathelement path="${lib.dir}/ecs-1.4.2.jar" />
</path>

<target name="generateCSSTemplate" depends="web, jar">
        <mkdir dir="${output.dir}" />
        <java classname="com.bolsinga.web.CSS" fork="true">
                <arg value="${output.dir}/styles/" />
                <classpath refid="music_classpath" />
        </java>
</target>

<target name="encoding" depends="music, diary, jar">
  <mkdir dir="${output.dir}" />
  <java classname="com.bolsinga.web.Encode" fork="true">
    <arg value="${data.dir}diary.xml" />
    <arg value="${data.dir}music.xml" />
    <arg value="${data.dir}settings.xml" />
    <arg value="${output.dir}" />
    <classpath refid="generate_web_classpath" />
  </java>
</target>

<!--    Add the following property to any web using code to have the output's
                container tags be pretty printed. This can assist in debugging the output.

                <sysproperty key="web.pretty_containers" value="true" />
-->

<target name="generateMusicWeb" depends="music, jar">
        <mkdir dir="${output.dir}" />
        <java classname="com.bolsinga.music.Web" fork="true">
                <arg value="${data.dir}music.xml" />
                <arg value="${data.dir}settings.xml" />
                <arg value="${output.dir}" />
                <classpath refid="generate_web_classpath" />
        </java>
</target>

<target name="generateDiaryWeb" depends="diary, jar">
        <mkdir dir="${output.dir}" />
        <java classname="com.bolsinga.diary.Web" fork="true">
                <arg value="${data.dir}diary.xml" />
                <arg value="${data.dir}music.xml" />
                <arg value="${data.dir}settings.xml" />
                <arg value="${output.dir}" />
                <classpath refid="generate_web_classpath" />
        </java>
</target>

<target name="generateRSS" depends="rss, jar" >
        <mkdir dir="${output.dir}" />
        <java classname="com.bolsinga.rss.RSS" fork="true" >
                <arg value="${data.dir}diary.xml" />
                <arg value="${data.dir}music.xml" />
                <arg value="${data.dir}settings.xml" />
                <arg value="${output.dir}" />
                <classpath refid="generate_web_classpath" />
        </java>
</target>

<target name="generateICal" depends="music, jar">
        <mkdir dir="${output.dir}" />
        <java classname="com.bolsinga.music.ICal" fork="true">
                <arg value="${data.dir}music.xml" />
                <arg value="${data.dir}settings.xml" />
                <arg value="${output.dir}" />
                <classpath refid="generate_web_classpath" />
        </java>
</target>

<!--
Here is the command line expanded.
java -cp lib/ecs-1.4.2.jar:build/lib/music.jar:lib/jwsdp-1_3/jaxb/lib/jaxb-api.jar:lib/jwsdp-1_3/jaxb/lib/jaxb-impl.jar:lib/jwsdp-1_3/jaxb/lib/jaxb-libs.jar:lib/jwsdp-1_3/jwsdp-shared/lib/jax-qname.jar:lib/jwsdp-1_3/jwsdp-shared/lib/namespace.jar:lib/jwsdp-1_3/jwsdp-shared/lib/relaxngDatatype.jar:lib/jwsdp-1_3/jwsdp-shared/lib/xsdlib.jar com.bolsinga.site.Site ../data/diary.xml ../data/music.xml ../data/settings.xml /Volumes/Home/bolsinga/Sites all
-->

<target name="Site" depends="site, jar">
  <mkdir dir="${output.dir}" />
  <java classname="com.bolsinga.site.Site" fork="true">
    <arg value="${data.dir}diary.xml" />
    <arg value="${data.dir}music.xml" />
    <arg value="${data.dir}settings.xml" />
    <arg value="${output.dir}" />
    <arg value="all" />
    <classpath refid="generate_web_classpath" />
  </java>
</target>

<target name="SiteWeb" depends="site, jar">
        <mkdir dir="${output.dir}" />
        <java classname="com.bolsinga.site.Site" fork="true">
                <arg value="${data.dir}diary.xml" />
                <arg value="${data.dir}music.xml" />
                <arg value="${data.dir}settings.xml" />
                <arg value="${output.dir}" />
        <arg value="web" />
                <classpath refid="generate_web_classpath" />
        </java>
</target>

<target name="SiteMusic" depends="site, jar">
        <mkdir dir="${output.dir}" />
        <java classname="com.bolsinga.site.Site" fork="true">
                <arg value="${data.dir}diary.xml" />
                <arg value="${data.dir}music.xml" />
                <arg value="${data.dir}settings.xml" />
                <arg value="${output.dir}" />
        <arg value="music" />
                <classpath refid="generate_web_classpath" />
        </java>
</target>

<target name="SiteDiary" depends="site, jar">
        <mkdir dir="${output.dir}" />
        <java classname="com.bolsinga.site.Site" fork="true">
                <arg value="${data.dir}diary.xml" />
                <arg value="${data.dir}music.xml" />
                <arg value="${data.dir}settings.xml" />
                <arg value="${output.dir}" />
        <arg value="diary" />
                <classpath refid="generate_web_classpath" />
        </java>
</target>

<target name="generateXML" depends="generateMusicXML, generateDiaryXML" />

<target name="install">
    <ftp    server="ftp.io.com"
            userid="bolsinga"
            password="${ftp.password}"
            remotedir="public-web"
            verbose="yes" >
        <fileset dir="${output.dir}">
            <include name="index.html" />
            <include name="archives/*" />
            <include name="bands/*" />
            <include name="cities/*" />
            <include name="dates/*" />
            <include name="ical/*" />
            <include name="rss/rss.xml" />
            <include name="styles/*" />
            <include name="tracks/*" />
            <include name="venues/*" />
        </fileset>
    </ftp>
</target>

<target name="installDiary">
    <ftp    server="ftp.io.com"
            userid="bolsinga"
            password="${ftp.password}"
            remotedir="public-web"
            verbose="yes" >
        <fileset dir="${output.dir}">
            <include name="index.html" />
            <include name="archives/*" />
            <include name="rss/rss.xml" />
        </fileset>
    </ftp>
</target>

<target name="package" depends="site, music_converter, jar" >
  <mkdir dir="${dst.dir}" />
  <mkdir dir="${dst.lib}" />
  <copy file="${build.lib}/music.jar" todir="${dst.lib}" />
  <copy todir="${dst.lib}">
    <fileset dir="${lib.dir}">
      <include name="jwsdp-1_3/jaxb/lib/jaxb-api.jar" />
      <include name="jwsdp-1_3/jaxb/lib/jaxb-impl.jar" />
      <include name="jwsdp-1_3/jaxb/lib/jaxb-libs.jar" />
      <include name="jwsdp-1_3/jwsdp-shared/lib/jax-qname.jar" />
      <include name="jwsdp-1_3/jwsdp-shared/lib/namespace.jar" />
      <include name="jwsdp-1_3/jwsdp-shared/lib/relaxngDatatype.jar" />
      <include name="jwsdp-1_3/jwsdp-shared/lib/xsdlib.jar" />
    </fileset>
  </copy>
  <copy file="${lib.dir}/ecs-1.4.2.jar" todir="${dst.lib}" />
</target>

</project>
