<?xml version="1.0" ?>

<project name="shows" default="generateAll" basedir=".">

<!--	This assumes that jwsdp is installed at /usr/local/jwsdp-1.3/ 
		Otherwise can be set with "ant -Djwsdp.home=..." -->

<property name="jwsdp.home" value="/usr/local/jwsdp-1.3" />

<path id="jaxb_classpath">
	<pathelement path="." />
	<!-- for use with bundled ant -->
	<fileset dir="${jwsdp.home}" includes="jaxb/lib/*.jar" />
	<fileset dir="${jwsdp.home}" includes="jwsdp-shared/lib/*.jar" />
	<fileset dir="${jwsdp.home}" includes="jaxp/lib/**/*.jar" />
</path>

<taskdef name="xjc" classname="com.sun.tools.xjc.XJCTask">
	<classpath refid="jaxb_classpath" />
</taskdef>

<property name="legacy_data.dir" value="../data/" />
<property name="data.dir" value="../data/" />
<property name="output.dir" value="/tmp/web" />

<property name="music.no_embedded_links" value="false" />

<property name="src.dir" value="src" />
<property name="lib.dir" value="lib" />
<property name="dist.dir" value="dist" />

<property name="build.dir" value="build" />
<property name="build.classes" value="${build.dir}/classes" />
<property name="build.lib" value="${build.dir}/lib" />
<property name="build.gensrc" value="${build.dir}/gensrc" />

<property name="javac.debug" value="no" />

<target name="clean">
	<delete dir="${build.dir}" />
</target>

<target name="prepare">
	<tstamp/>
	<mkdir dir="${build.dir}" />
	<mkdir dir="${build.classes}" />
	<mkdir dir="${build.lib}" />
	<mkdir dir="${build.gensrc}" />
</target>

<target name="music_binding" depends="prepare">
	<xjc schema="xml/music.xsd" target="${build.gensrc}" package="com.bolsinga.music.data" removeOldOutput="yes">
		<depends dir="xml" includes="music.xsd" />
		<produces dir="${build.gensrc}/com/bolsinga/music/data" includes="*impl/*" />
	</xjc>
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${build.gensrc}" />
		<include name="com/bolsinga/music/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
	<copy todir="${build.classes}">
		<fileset dir="${build.gensrc}" >
			<exclude name="**/*.java" />
		</fileset>
	</copy>
</target>

<target name="diary_binding" depends="prepare">
	<xjc schema="xml/diary.xsd" target="${build.gensrc}" package="com.bolsinga.diary.data" removeOldOutput="yes">
		<depends dir="xml" includes="diary.xsd" />
		<produces dir="${build.gensrc}/com/bolsinga/diary/data" includes="*impl/*" />
	</xjc>
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${build.gensrc}" />
		<include name="com/bolsinga/diary/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
	<copy todir="${build.classes}">
		<fileset dir="${build.gensrc}" >
			<exclude name="**/*.java" />
		</fileset>
	</copy>
</target>

<target name="rss_binding" depends="prepare">
	<xjc schema="xml/rss-2_0.xsd" target="${build.gensrc}" package="com.bolsinga.rss.data" removeOldOutput="yes" extension="true">
		<depends dir="xml" includes="rss-2_0.xsd" />
		<produces dir="${build.gensrc}/com/bolsinga/rss/data" includes="*impl/*" />
	</xjc>
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${build.gensrc}" />
		<include name="com/bolsinga/rss/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
	<copy todir="${build.classes}">
		<fileset dir="${build.gensrc}" >
			<exclude name="**/*.java" />
		</fileset>
	</copy>
</target>

<path id="web_classpath">
	<path refid="jaxb_classpath" />
	<pathelement path="${lib.dir}/ecs-1.4.2.jar" />
</path>

<target name="music_utilities" depends="music_binding">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/music/util/**" />
		<classpath refid="web_classpath" />
	</javac>
</target>

<target name="diary_utilities" depends="diary_binding">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/diary/util/**" />
		<classpath refid="web_classpath" />
	</javac>
</target>

<target name="rss_utilities" depends="rss_binding">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/rss/util/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
</target>

<target name="converter" depends="music_utilities, diary_binding">
	<javac	destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/shows/converter/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
</target>

<target name="music_web" depends="music_utilities">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/music/web/**" />
		<classpath refid="web_classpath" />
	</javac>
	<tstamp>
		<format property="music.builddate" pattern="EEE MMM dd HH:mm:ss z yyyy" />
	</tstamp>
	<copy file="${src.dir}/properties/config.properties" tofile="${build.classes}/com/bolsinga/music/web/web.properties">
		<filterset>
			<filter token="builddate" value="${music.builddate}" />
			<filter token="program" value="MusicWeb" />
		</filterset>
	</copy>
</target>

<target name="music_rss" depends="rss_utilities, music_utilities">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/music/rss/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
	<tstamp>
		<format property="music.rss.builddate" pattern="EEE MMM dd HH:mm:ss z yyyy" />
	</tstamp>
	<copy file="${src.dir}/properties/config.properties" tofile="${build.classes}/com/bolsinga/music/rss/rss.properties">
		<filterset>
			<filter token="builddate" value="${music.rss.builddate}" />
			<filter token="program" value="MusicRSS" />
		</filterset>
	</copy>
</target>

<target name="diary_web" depends="diary_utilities">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/diary/web/**" />
		<classpath refid="web_classpath" />
	</javac>
	<tstamp>
		<format property="diary.builddate" pattern="EEE MMM dd HH:mm:ss z yyyy" />
	</tstamp>
	<copy file="${src.dir}/properties/config.properties" tofile="${build.classes}/com/bolsinga/diary/web/web.properties">
		<filterset>
			<filter token="builddate" value="${diary.builddate}" />
			<filter token="program" value="DiaryWeb" />
		</filterset>
	</copy>
</target>

<target name="diary_rss" depends="rss_utilities, diary_utilities">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/diary/rss/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
	<tstamp>
		<format property="diary.rss.builddate" pattern="EEE MMM dd HH:mm:ss z yyyy" />
	</tstamp>
	<copy file="${src.dir}/properties/config.properties" tofile="${build.classes}/com/bolsinga/diary/rss/rss.properties">
		<filterset>
			<filter token="builddate" value="${diary.rss.builddate}" />
			<filter token="program" value="DiaryRSS" />
		</filterset>
	</copy>
</target>

<target name="ical-gen" depends="prepare">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/ical/**" />
	</javac>
</target>

<target name="ical" depends="ical-gen, music_utilities">
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/music/ical/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
</target>

<target name="jar">
	<jar jarfile="${build.lib}/music.jar"
		basedir="${build.classes}" >
		<include name="com/bolsinga/**" />
	</jar>
</target>

<path id="music_classpath">
	<path refid="jaxb_classpath" />
	<pathelement path="${build.lib}/music.jar" />
</path>

<target name="generateMusicXML" depends="converter, jar">
	<java classname="com.bolsinga.shows.converter.Music" fork="true">
		<arg value="${legacy_data.dir}shows.txt" />
		<arg value="${legacy_data.dir}venuemap.txt" />
		<arg value="${legacy_data.dir}bandsort.txt" />
		<arg value="${legacy_data.dir}relations.txt" />
		<arg value="${data.dir}music.xml" />
		<classpath refid="music_classpath" />
	</java>
</target>

<target name="generateDiaryXML" depends="converter, jar">
	<java classname="com.bolsinga.shows.converter.Diary" fork="true">
		<sysproperty key="diary.title" value="En Vogue Webmaster" />
		<arg value="${legacy_data.dir}comments.txt" />
		<arg value="${legacy_data.dir}statics.txt" />
		<arg value="${data.dir}diary.xml" />
		<classpath refid="music_classpath" />
	</java>
</target>

<path id="generate_web_classpath">
	<path refid="music_classpath" />
	<pathelement path="${lib.dir}/ecs-1.4.2.jar" />
</path>

<target name="generateMusicWeb" depends="music_web, jar">
	<mkdir dir="${output.dir}" />
	<java classname="com.bolsinga.music.web.Web" fork="true">
		<sysproperty key="music.contact" value="bolsinga@hotmail.com" />
		<sysproperty key="music.root" value="../index.html" />
		<sysproperty key="music.no_embedded_links" value="${music.no_embedded_links}" />
		<arg value="${data.dir}music.xml" />
		<arg value="${output.dir}" />
		<classpath refid="generate_web_classpath" />
	</java>
</target>

<target name="generateMusicRSS" depends="music_rss, jar" >
	<mkdir dir="${output.dir}/rss/" />
	<java classname="com.bolsinga.music.rss.RSS" fork="true" >
		<sysproperty key="music.title" value="Rock!" />
		<sysproperty key="music.contact" value="bolsinga@hotmail.com" />
		<sysproperty key="music.link" value="http://www.io.com/~bolsinga/" />
		<sysproperty key="music.description" value="Recent Rock shows seen by Greg Bolsinga" />
		<sysproperty key="music.no_embedded_links" value="true" />
		<arg value="5" />
		<arg value="${data.dir}music.xml" />
		<arg value="${output.dir}/rss/music.xml" />
		<classpath refid="generate_web_classpath" />
	</java>
</target>

<target name="generateDiaryWeb" depends="music_web, diary_web, jar">
	<mkdir dir="${output.dir}" />
	<java classname="com.bolsinga.diary.web.Web" fork="true">
		<sysproperty key="diary.contact" value="bolsinga@hotmail.com" />
		<sysproperty key="diary.root" value="../index.html" />
		<sysproperty key="music.no_embedded_links" value="${music.no_embedded_links}" />
		<arg value="3" />
		<arg value="${data.dir}diary.xml" />
		<arg value="${data.dir}music.xml" />
		<arg value="${output.dir}" />
		<classpath refid="generate_web_classpath" />
	</java>
</target>

<target name="generateDiaryRSS" depends="diary_rss, jar" >
	<mkdir dir="${output.dir}/rss/" />
	<java classname="com.bolsinga.diary.rss.RSS" fork="true" >
		<sysproperty key="diary.contact" value="bolsinga@hotmail.com" />
		<sysproperty key="diary.link" value="http://www.io.com/~bolsinga/" />
		<sysproperty key="diary.description" value="Random posts from Greg Bolsinga" />
		<sysproperty key="music.no_embedded_links" value="true" />
		<arg value="5" />
		<arg value="${data.dir}diary.xml" />
		<arg value="${output.dir}/rss/diary.xml" />
		<classpath refid="generate_web_classpath" />
	</java>
</target>

<target name="generateICal" depends="ical, jar">
	<mkdir dir="${output.dir}/ical/" />
	<java classname="com.bolsinga.music.ical.ICal" fork="true">
		<arg value="${data.dir}music.xml" />
		<arg value="${output.dir}/ical/" />
		<classpath refid="music_classpath" />
	</java>
</target>

<target name="music_edit" depends="music_web" >
	<javac  destdir="${build.classes}"
			debug="${javac.debug}"
			deprecation="on">
		<src path="${src.dir}" />
		<include name="com/bolsinga/music/ui/**" />
		<classpath refid="jaxb_classpath" />
	</javac>
</target>

<target name="editMusic" depends="music_edit, jar" >
	<java classname="com.bolsinga.music.ui.UI" fork="true" >
		<arg value="${data.dir}music.xml" />
		<classpath refid="music_classpath" />
	</java>
</target>

<target name="music" depends="converter, music_web, diary_web, diary_rss, ical, jar" />

<target name="generateXML" depends="music, generateMusicXML, generateDiaryXML" />

<target name="generateWeb" depends="music, generateMusicWeb, generateDiaryWeb" />

<target name="generateRSS" depends="music, generateMusicRSS, generateDiaryRSS" />

<target name="generateAll" depends="generateXML, generateWeb, generateRSS, generateICal" />

</project>
